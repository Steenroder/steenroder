<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>steenroder.core &mdash; steenroder version 0.1.0</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> steenroder
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../user_guide.html">User Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide.html#tutorials">Tutorials</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../_notebooks/squares.html">Steenrod squares</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../_notebooks/cp2.html">Complex projective space and a wedge of spheres</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../_notebooks/cp2.html#\mathbb-CP^2-and-S^2-\vee-S^4"><span class="math notranslate nohighlight">\(\mathbb CP^2\)</span> and <span class="math notranslate nohighlight">\(S^2 \vee S^4\)</span></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_notebooks/cp2.html#\Sigma\mathbb-CP^2-and-\Sigma(S^2-\vee-S^4)"><span class="math notranslate nohighlight">\(\Sigma\mathbb CP^2\)</span> and <span class="math notranslate nohighlight">\(\Sigma(S^2 \vee S^4)\)</span></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_notebooks/cp2.html#\mathrm{C}\,\Sigma\,\mathbb-CP^2-and-\mathrm{C}\,\Sigma(S^2-\vee-S^4)"><span class="math notranslate nohighlight">\(\mathrm{C}\,\Sigma\,\mathbb CP^2\)</span> and <span class="math notranslate nohighlight">\(\mathrm{C}\,\Sigma(S^2 \vee S^4)\)</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide.html#examples">Examples</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../api_reference.html">API Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../api_reference.html#core">Core</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../generated/steenroder.compute_reduced_triangular.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">steenroder</span></code>.compute_reduced_triangular</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../generated/steenroder.compute_barcode_and_coho_reps.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">steenroder</span></code>.compute_barcode_and_coho_reps</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../generated/steenroder.compute_steenrod_matrix.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">steenroder</span></code>.compute_steenrod_matrix</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../generated/steenroder.compute_steenrod_barcode.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">steenroder</span></code>.compute_steenrod_barcode</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../generated/steenroder.barcodes.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">steenroder</span></code>.barcodes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../generated/steenroder.rips_barcodes.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">steenroder</span></code>.rips_barcodes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api_reference.html#preprocessing">Preprocessing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../generated/steenroder.make_simplices.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">steenroder</span></code>.make_simplices</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../generated/steenroder.make_filtration.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">steenroder</span></code>.make_filtration</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../generated/steenroder.sort_filtration_by_dim.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">steenroder</span></code>.sort_filtration_by_dim</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../generated/steenroder.cone.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">steenroder</span></code>.cone</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../generated/steenroder.suspension.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">steenroder</span></code>.suspension</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../generated/steenroder.sphere.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">steenroder</span></code>.sphere</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../generated/steenroder.wedge.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">steenroder</span></code>.wedge</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api_reference.html#visualization">Visualization</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../generated/steenroder.plot_diagrams.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">steenroder</span></code>.plot_diagrams</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">steenroder</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../index.html">Module code</a> &raquo;</li>
      <li>steenroder.core</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for steenroder.core</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">gudhi</span>
<span class="kn">import</span> <span class="nn">psutil</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">numba</span> <span class="k">as</span> <span class="nn">nb</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">lru_cache</span>
<span class="kn">from</span> <span class="nn">numba.cpython.unsafe.tuple</span> <span class="kn">import</span> <span class="n">tuple_setitem</span>
<span class="kn">from</span> <span class="nn">numba.np.unsafe.ndarray</span> <span class="kn">import</span> <span class="n">to_fixed_tuple</span>

<span class="kn">from</span> <span class="nn">.preprocessing</span> <span class="kn">import</span> <span class="n">sort_filtration_by_dim</span>


<span class="n">list_of_int64_typ</span> <span class="o">=</span> <span class="n">nb</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">List</span><span class="p">(</span><span class="n">nb</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
<span class="n">int64_2d_array_typ</span> <span class="o">=</span> <span class="n">nb</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">Array</span><span class="p">(</span><span class="n">nb</span><span class="o">.</span><span class="n">int64</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="p">)</span>

<span class="c1"># Determine the number of available physical cores</span>
<span class="n">N_PHYSICAL_CORES</span> <span class="o">=</span> <span class="n">psutil</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">(</span><span class="n">logical</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>


<span class="nd">@nb</span><span class="o">.</span><span class="n">njit</span>
<span class="k">def</span> <span class="nf">_twist_reduction</span><span class="p">(</span><span class="n">coboundary</span><span class="p">,</span> <span class="n">triangular</span><span class="p">,</span> <span class="n">pivots_lookup</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Core of the persistent relative cohomology reduction algorithm using the</span>
<span class="sd">    clearing optimization.&quot;&quot;&quot;</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">coboundary</span><span class="p">)</span>

    <span class="n">rel_idxs_to_clear</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">highest_one</span> <span class="o">=</span> <span class="n">coboundary</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">coboundary</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">pivot_col</span> <span class="o">=</span> <span class="n">pivots_lookup</span><span class="p">[</span><span class="n">highest_one</span><span class="p">]</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">highest_one</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">pivot_col</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">coboundary</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">_symm_diff</span><span class="p">(</span><span class="n">coboundary</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">:],</span>
                                       <span class="n">coboundary</span><span class="p">[</span><span class="n">pivot_col</span><span class="p">][</span><span class="mi">1</span><span class="p">:])</span>
            <span class="n">triangular</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">_symm_diff</span><span class="p">(</span><span class="n">triangular</span><span class="p">[</span><span class="n">j</span><span class="p">],</span>
                                       <span class="n">triangular</span><span class="p">[</span><span class="n">pivot_col</span><span class="p">])</span>
            <span class="n">highest_one</span> <span class="o">=</span> <span class="n">coboundary</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">coboundary</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span>
            <span class="n">pivot_col</span> <span class="o">=</span> <span class="n">pivots_lookup</span><span class="p">[</span><span class="n">highest_one</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">highest_one</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">pivots_lookup</span><span class="p">[</span><span class="n">highest_one</span><span class="p">]</span> <span class="o">=</span> <span class="n">j</span>
            <span class="n">rel_idxs_to_clear</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">highest_one</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">rel_idxs_to_clear</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>


<span class="nd">@lru_cache</span>
<span class="k">def</span> <span class="nf">_reduce_single_dim</span><span class="p">(</span><span class="n">dim</span><span class="p">):</span>
    <span class="n">len_tups_dim</span> <span class="o">=</span> <span class="n">dim</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">tuple_typ_dim</span> <span class="o">=</span> <span class="n">nb</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">UniTuple</span><span class="p">(</span><span class="n">nb</span><span class="o">.</span><span class="n">int64</span><span class="p">,</span> <span class="n">len_tups_dim</span><span class="p">)</span>
    <span class="n">len_tups_next_dim</span> <span class="o">=</span> <span class="n">dim</span> <span class="o">+</span> <span class="mi">2</span>

    <span class="nd">@nb</span><span class="o">.</span><span class="n">njit</span>
    <span class="k">def</span> <span class="nf">_inner_reduce_single_dim</span><span class="p">(</span><span class="n">idxs_dim</span><span class="p">,</span> <span class="n">tups_dim</span><span class="p">,</span> <span class="n">rel_idxs_to_clear</span><span class="p">,</span>
                                 <span class="n">idxs_next_dim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tups_next_dim</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;R = MV&quot;&quot;&quot;</span>
        <span class="c1"># 1) Construct sp2idx_dim as a dict simplex: relative (i.e.</span>
        <span class="c1"># in-dimension) index</span>
        <span class="c1"># 2) Initialize type of reduced_dim (needed for type inference)</span>
        <span class="c1"># 3) Construct triangular_dim, with entries denoting relative (i.e.</span>
        <span class="c1"># in-dimension) indices</span>
        <span class="n">spx2idx_dim</span> <span class="o">=</span> <span class="n">nb</span><span class="o">.</span><span class="n">typed</span><span class="o">.</span><span class="n">Dict</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">tuple_typ_dim</span><span class="p">,</span> <span class="n">nb</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
        <span class="n">reduced_dim</span> <span class="o">=</span> <span class="n">nb</span><span class="o">.</span><span class="n">typed</span><span class="o">.</span><span class="n">List</span><span class="o">.</span><span class="n">empty_list</span><span class="p">(</span><span class="n">list_of_int64_typ</span><span class="p">)</span>
        <span class="n">triangular_dim</span> <span class="o">=</span> <span class="n">nb</span><span class="o">.</span><span class="n">typed</span><span class="o">.</span><span class="n">List</span><span class="o">.</span><span class="n">empty_list</span><span class="p">(</span><span class="n">list_of_int64_typ</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">idxs_dim</span><span class="p">)):</span>
            <span class="n">spx</span> <span class="o">=</span> <span class="n">to_fixed_tuple</span><span class="p">(</span><span class="n">tups_dim</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">len_tups_dim</span><span class="p">)</span>
            <span class="n">spx2idx_dim</span><span class="p">[</span><span class="n">spx</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
            <span class="n">reduced_dim</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">nb</span><span class="o">.</span><span class="n">int64</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">)])</span>
            <span class="n">triangular_dim</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">i</span><span class="p">])</span>

        <span class="c1"># Populate reduced_dim as the coboundary matrix and apply clearing</span>
        <span class="c1"># WARNING: Column entries denote relative (i.e. in-dimension) indices!</span>
        <span class="k">if</span> <span class="n">idxs_next_dim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">idxs_next_dim</span><span class="p">)):</span>
                <span class="n">spx</span> <span class="o">=</span> <span class="n">to_fixed_tuple</span><span class="p">(</span><span class="n">tups_next_dim</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">len_tups_next_dim</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">face</span> <span class="ow">in</span> <span class="n">_drop_elements</span><span class="p">(</span><span class="n">spx</span><span class="p">):</span>
                    <span class="n">reduced_dim</span><span class="p">[</span><span class="n">spx2idx_dim</span><span class="p">[</span><span class="n">face</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">rel_idx</span> <span class="ow">in</span> <span class="n">rel_idxs_to_clear</span><span class="p">:</span>
                <span class="n">reduced_dim</span><span class="p">[</span><span class="n">rel_idx</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">nb</span><span class="o">.</span><span class="n">int64</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">)]</span>

            <span class="n">pivots_lookup</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">idxs_next_dim</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>

            <span class="n">rel_idxs_to_clear</span> <span class="o">=</span> <span class="n">_twist_reduction</span><span class="p">(</span><span class="n">reduced_dim</span><span class="p">,</span> <span class="n">triangular_dim</span><span class="p">,</span>
                                                 <span class="n">pivots_lookup</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pivots_lookup</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">spx2idx_dim</span><span class="p">,</span> <span class="n">reduced_dim</span><span class="p">,</span> <span class="n">triangular_dim</span><span class="p">,</span>
                <span class="n">rel_idxs_to_clear</span><span class="p">,</span> <span class="n">pivots_lookup</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">_inner_reduce_single_dim</span>


<span class="nd">@nb</span><span class="o">.</span><span class="n">njit</span>
<span class="k">def</span> <span class="nf">_fix_triangular_after_clearing</span><span class="p">(</span><span class="n">triangular</span><span class="p">,</span> <span class="n">reduced_prev_dim</span><span class="p">,</span>
                                   <span class="n">rel_idxs_to_clear</span><span class="p">,</span> <span class="n">pivots_lookup_prev_dim</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Massage the V matrix to maintain the R = DV decomposition after clearing,</span>
<span class="sd">    as described in https://arxiv.org/abs/1908.02518, Sec. 3.2.&quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">rel_idx</span> <span class="ow">in</span> <span class="n">rel_idxs_to_clear</span><span class="p">:</span>
        <span class="n">triangular</span><span class="p">[</span><span class="n">rel_idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">reduced_prev_dim</span><span class="p">[</span><span class="n">pivots_lookup_prev_dim</span><span class="p">[</span><span class="n">rel_idx</span><span class="p">]]</span>


<div class="viewcode-block" id="compute_reduced_triangular"><a class="viewcode-back" href="../../generated/steenroder.compute_reduced_triangular.html#steenroder.compute_reduced_triangular">[docs]</a><span class="k">def</span> <span class="nf">compute_reduced_triangular</span><span class="p">(</span><span class="n">filtration_by_dim</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compute the matrices R and V in the decomposition R = DV.</span>

<span class="sd">    Explicitly, D is the coboundary matrix of the filtration, R is a reduced</span>
<span class="sd">    matrix, and V is a full-rank upper-triangular one.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    filtration_by_dim : list of list of ndarray</span>
<span class="sd">        For each dimension ``d``, a list of 2 aligned int arrays: the first is</span>
<span class="sd">        a 1D array containing the (ordered) positional indices of all</span>
<span class="sd">        ``d``-dimensional simplices in `filtration`; the second is a 2D array</span>
<span class="sd">        whose ``i``-th row is the (sorted) collection of vertices defining the</span>
<span class="sd">        ``i``-th ``d``-dimensional simplex.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    spx2idx : tuple of ``numba.typed.Dict``</span>
<span class="sd">        One dictionary per simplex dimension. The dimension-``d`` dictionary has</span>
<span class="sd">        the filtration ``d``-simplices (tuples of ints) as keys; the</span>
<span class="sd">        corresponding values are the positional indices of those simplices</span>
<span class="sd">        relative to the ``d``-dimensional portion of the filtration.</span>

<span class="sd">    idxs : tuple of ndarray</span>
<span class="sd">        For each dimension ``d``, this is the same as</span>
<span class="sd">        ``filtration_by_dim[d][0]`` and is returned for convenience.</span>

<span class="sd">    reduced : tuple of ``numba.typed.List``</span>
<span class="sd">        One list of int per simplex dimension. ``reduced[d]`` is the</span>
<span class="sd">        ``d``-dimensional part of the &quot;R&quot; matrix in R = DV. In the computation,</span>
<span class="sd">        ``reduced[d][i]`` is initialized as the coboundary of the ``i``th input</span>
<span class="sd">        simplex in ``filtration_by_dim[d][1]``, i.e. as the sorted list of</span>
<span class="sd">        positional indices (relative to the ``(d+1)``-dimensional portion of the</span>
<span class="sd">        filtration) of that simplex&#39;s cofacets.</span>

<span class="sd">    triangular : tuple of ``numba.typed.List``</span>
<span class="sd">        On list of int per simplex dimension. ``triangular[d]`` is the</span>
<span class="sd">        ``d``-dimensional part of the &quot;V&quot; matrix in R = DV. In the computation,</span>
<span class="sd">        ``triangular[d][i]`` is initialized as the singleton list ``[i]``.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">maxdim</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">filtration_by_dim</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">spx2idx_idxs_reduced_triangular</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># Initialize relative (i.e. in-dimension) indices to clear, as an empty</span>
    <span class="c1"># int array in dim 0</span>
    <span class="n">rel_idxs_to_clear</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
    <span class="n">reduced_prev_dim</span> <span class="o">=</span> <span class="n">nb</span><span class="o">.</span><span class="n">typed</span><span class="o">.</span><span class="n">List</span><span class="o">.</span><span class="n">empty_list</span><span class="p">(</span><span class="n">list_of_int64_typ</span><span class="p">)</span>
    <span class="n">pivots_lookup_prev_dim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">maxdim</span><span class="p">):</span>
        <span class="n">reduction_dim</span> <span class="o">=</span> <span class="n">_reduce_single_dim</span><span class="p">(</span><span class="n">dim</span><span class="p">)</span>
        <span class="n">idxs_dim</span><span class="p">,</span> <span class="n">tups_dim</span> <span class="o">=</span> <span class="n">filtration_by_dim</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span>
        <span class="n">idxs_next_dim</span><span class="p">,</span> <span class="n">tups_next_dim</span> <span class="o">=</span> <span class="n">filtration_by_dim</span><span class="p">[</span><span class="n">dim</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
        <span class="p">(</span><span class="n">spx2idx_dim</span><span class="p">,</span> <span class="n">reduced_dim</span><span class="p">,</span> <span class="n">triangular_dim</span><span class="p">,</span>
         <span class="n">rel_idxs_to_clear_next_dim</span><span class="p">,</span> <span class="n">pivots_lookup</span><span class="p">)</span> <span class="o">=</span> \
            <span class="n">reduction_dim</span><span class="p">(</span><span class="n">idxs_dim</span><span class="p">,</span>
                          <span class="n">tups_dim</span><span class="p">,</span>
                          <span class="n">rel_idxs_to_clear</span><span class="p">,</span>
                          <span class="n">idxs_next_dim</span><span class="o">=</span><span class="n">idxs_next_dim</span><span class="p">,</span>
                          <span class="n">tups_next_dim</span><span class="o">=</span><span class="n">tups_next_dim</span><span class="p">)</span>
        <span class="n">_fix_triangular_after_clearing</span><span class="p">(</span><span class="n">triangular_dim</span><span class="p">,</span>
                                       <span class="n">reduced_prev_dim</span><span class="p">,</span>
                                       <span class="n">rel_idxs_to_clear</span><span class="p">,</span>
                                       <span class="n">pivots_lookup_prev_dim</span><span class="p">)</span>
        <span class="n">spx2idx_idxs_reduced_triangular</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">spx2idx_dim</span><span class="p">,</span>
                                                <span class="n">idxs_dim</span><span class="p">,</span>
                                                <span class="n">reduced_dim</span><span class="p">,</span>
                                                <span class="n">triangular_dim</span><span class="p">))</span>
        <span class="n">rel_idxs_to_clear</span> <span class="o">=</span> <span class="n">rel_idxs_to_clear_next_dim</span>
        <span class="n">reduced_prev_dim</span> <span class="o">=</span> <span class="n">reduced_dim</span>
        <span class="n">pivots_lookup_prev_dim</span> <span class="o">=</span> <span class="n">pivots_lookup</span>

    <span class="n">reduction_dim</span> <span class="o">=</span> <span class="n">_reduce_single_dim</span><span class="p">(</span><span class="n">maxdim</span><span class="p">)</span>
    <span class="n">idxs_dim</span><span class="p">,</span> <span class="n">tups_dim</span> <span class="o">=</span> <span class="n">filtration_by_dim</span><span class="p">[</span><span class="n">maxdim</span><span class="p">]</span>
    <span class="n">spx2idx_dim</span><span class="p">,</span> <span class="n">reduced_dim</span><span class="p">,</span> <span class="n">triangular_dim</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> \
        <span class="n">reduction_dim</span><span class="p">(</span><span class="n">idxs_dim</span><span class="p">,</span> <span class="n">tups_dim</span><span class="p">,</span> <span class="n">rel_idxs_to_clear</span><span class="p">)</span>
    <span class="n">_fix_triangular_after_clearing</span><span class="p">(</span><span class="n">triangular_dim</span><span class="p">,</span>
                                   <span class="n">reduced_prev_dim</span><span class="p">,</span>
                                   <span class="n">rel_idxs_to_clear</span><span class="p">,</span>
                                   <span class="n">pivots_lookup_prev_dim</span><span class="p">)</span>
    <span class="n">spx2idx_idxs_reduced_triangular</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">spx2idx_dim</span><span class="p">,</span>
                                            <span class="n">idxs_dim</span><span class="p">,</span>
                                            <span class="n">reduced_dim</span><span class="p">,</span>
                                            <span class="n">triangular_dim</span><span class="p">))</span>

    <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">spx2idx_idxs_reduced_triangular</span><span class="p">))</span></div>


<div class="viewcode-block" id="compute_barcode_and_coho_reps"><a class="viewcode-back" href="../../generated/steenroder.compute_barcode_and_coho_reps.html#steenroder.compute_barcode_and_coho_reps">[docs]</a><span class="nd">@nb</span><span class="o">.</span><span class="n">njit</span>
<span class="k">def</span> <span class="nf">compute_barcode_and_coho_reps</span><span class="p">(</span><span class="n">idxs</span><span class="p">,</span> <span class="n">reduced</span><span class="p">,</span> <span class="n">triangular</span><span class="p">,</span>
                              <span class="n">filtration_values</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compute the barcode of relative cohomology and cocycle representatives.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    idxs : tuple of ndarray</span>
<span class="sd">        For each dimension ``d``, a 1D int array containing the (ordered)</span>
<span class="sd">        positional indices of all ``d``-dimensional simplices in the filtration.</span>

<span class="sd">    reduced : tuple of ``numba.typed.List``</span>
<span class="sd">        One list of int per simplex dimension, representing the</span>
<span class="sd">        ``d``-dimensional part of the &quot;R&quot; matrix in R = DV. In the same format</span>
<span class="sd">        as returned by `compute_reduced_triangular`.</span>

<span class="sd">    triangular : tuple of ``numba.typed.List``</span>
<span class="sd">        One list of int per simplex dimension, representing the</span>
<span class="sd">        ``d``-dimensional part of the &quot;V&quot; matrix in R = DV. In the same format</span>
<span class="sd">        as returned by `compute_reduced_triangular`.</span>

<span class="sd">    filtration_values : ndarray or None, optional, default: None</span>
<span class="sd">        Optionally, a single 1D array of filtration values for each simplex in</span>
<span class="sd">        the filtration and in all dimensions contained in `idxs`, `reduced` and</span>
<span class="sd">        `triangular`. Bars with equal birth and death filtration values are</span>
<span class="sd">        discarded.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    barcode : list of ndarray</span>
<span class="sd">        For each dimension ``d``, a 2D int array of shape ``(n_bars, 2)``</span>
<span class="sd">        containing the birth (entry 1) and death (entry 0) indices of persistent</span>
<span class="sd">        relative homology classes in degree ``d``. See `filtration_values`.</span>
<span class="sd">        Essential bars are represented by pairs with death equal to ``-1``. Bars</span>
<span class="sd">        are sorted in order of decreasing birth indices.</span>

<span class="sd">    coho_reps : list of ``numba.typed.List``</span>
<span class="sd">        For each dimension ``d``, a list of representatives of persistent</span>
<span class="sd">        relative cohomology classes in degree ``d``. Each such representative is</span>
<span class="sd">        represented as a list of positional indices relative to the</span>
<span class="sd">        ``d``-dimensional portion of the filtration. ``coho_reps[d][j]``</span>
<span class="sd">        corresponds to ``barcode[d][j]``.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">barcode</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">coho_reps</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="n">filtration_values</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">pairs_0</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">coho_reps_0</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">idxs</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">reduced</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]:</span>
                <span class="n">pairs_0</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">idxs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]])</span>
                <span class="n">coho_reps_0</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">triangular</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
        <span class="n">pairs_0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">pairs_0</span><span class="p">)</span>
        <span class="n">lexsrt</span> <span class="o">=</span> <span class="n">_lexsort_barcode</span><span class="p">(</span><span class="n">pairs_0</span><span class="p">)</span>
        <span class="n">barcode</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pairs_0</span><span class="p">[</span><span class="n">lexsrt</span><span class="p">])</span>
        <span class="n">coho_reps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nb</span><span class="o">.</span><span class="n">typed</span><span class="o">.</span><span class="n">List</span><span class="p">([</span><span class="n">coho_reps_0</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">lexsrt</span><span class="p">]))</span>

        <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">idxs</span><span class="p">)):</span>
            <span class="n">all_birth_indices</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
            <span class="n">pairs_dim</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">coho_reps_dim</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">idxs</span><span class="p">[</span><span class="n">dim</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])):</span>
                <span class="k">if</span> <span class="n">reduced</span><span class="p">[</span><span class="n">dim</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]:</span>
                    <span class="n">b</span> <span class="o">=</span> <span class="n">idxs</span><span class="p">[</span><span class="n">dim</span><span class="p">][</span><span class="n">reduced</span><span class="p">[</span><span class="n">dim</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
                    <span class="n">d</span> <span class="o">=</span> <span class="n">idxs</span><span class="p">[</span><span class="n">dim</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">pairs_dim</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">d</span><span class="p">,</span> <span class="n">b</span><span class="p">])</span>
                    <span class="n">coho_reps_dim</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">reduced</span><span class="p">[</span><span class="n">dim</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
                    <span class="n">all_birth_indices</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">idxs</span><span class="p">[</span><span class="n">dim</span><span class="p">])):</span>
                <span class="k">if</span> <span class="n">idxs</span><span class="p">[</span><span class="n">dim</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">all_birth_indices</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">reduced</span><span class="p">[</span><span class="n">dim</span><span class="p">][</span><span class="n">i</span><span class="p">]:</span>
                        <span class="n">pairs_dim</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">idxs</span><span class="p">[</span><span class="n">dim</span><span class="p">][</span><span class="n">i</span><span class="p">]])</span>
                        <span class="n">coho_reps_dim</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">triangular</span><span class="p">[</span><span class="n">dim</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">pairs_dim</span><span class="p">):</span>
                <span class="n">pairs_dim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">pairs_dim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">pairs_dim</span><span class="p">)</span>
            <span class="n">lexsrt</span> <span class="o">=</span> <span class="n">_lexsort_barcode</span><span class="p">(</span><span class="n">pairs_dim</span><span class="p">)</span>
            <span class="n">barcode</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pairs_dim</span><span class="p">[</span><span class="n">lexsrt</span><span class="p">])</span>
            <span class="n">coho_reps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nb</span><span class="o">.</span><span class="n">typed</span><span class="o">.</span><span class="n">List</span><span class="p">([</span><span class="n">coho_reps_dim</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">lexsrt</span><span class="p">]))</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">pairs_0</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">coho_reps_0</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">idxs</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">reduced</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]:</span>
                <span class="n">pairs_0</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">idxs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]])</span>
                <span class="n">coho_reps_0</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">triangular</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
        <span class="n">pairs_0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">pairs_0</span><span class="p">)</span>
        <span class="n">lexsrt</span> <span class="o">=</span> <span class="n">_lexsort_barcode</span><span class="p">(</span><span class="n">pairs_0</span><span class="p">)</span>
        <span class="n">barcode</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pairs_0</span><span class="p">[</span><span class="n">lexsrt</span><span class="p">])</span>
        <span class="n">coho_reps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nb</span><span class="o">.</span><span class="n">typed</span><span class="o">.</span><span class="n">List</span><span class="p">([</span><span class="n">coho_reps_0</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">lexsrt</span><span class="p">]))</span>

        <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">idxs</span><span class="p">)):</span>
            <span class="n">all_birth_indices</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
            <span class="n">pairs_dim</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">coho_reps_dim</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">idxs</span><span class="p">[</span><span class="n">dim</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])):</span>
                <span class="k">if</span> <span class="n">reduced</span><span class="p">[</span><span class="n">dim</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]:</span>
                    <span class="n">b</span> <span class="o">=</span> <span class="n">idxs</span><span class="p">[</span><span class="n">dim</span><span class="p">][</span><span class="n">reduced</span><span class="p">[</span><span class="n">dim</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
                    <span class="n">d</span> <span class="o">=</span> <span class="n">idxs</span><span class="p">[</span><span class="n">dim</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">filtration_values</span><span class="p">[</span><span class="n">b</span><span class="p">]</span> <span class="o">!=</span> <span class="n">filtration_values</span><span class="p">[</span><span class="n">d</span><span class="p">]:</span>
                        <span class="n">pairs_dim</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">d</span><span class="p">,</span> <span class="n">b</span><span class="p">])</span>
                        <span class="n">coho_reps_dim</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">reduced</span><span class="p">[</span><span class="n">dim</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
                    <span class="n">all_birth_indices</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">idxs</span><span class="p">[</span><span class="n">dim</span><span class="p">])):</span>
                <span class="k">if</span> <span class="n">idxs</span><span class="p">[</span><span class="n">dim</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">all_birth_indices</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">reduced</span><span class="p">[</span><span class="n">dim</span><span class="p">][</span><span class="n">i</span><span class="p">]:</span>
                        <span class="n">pairs_dim</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">idxs</span><span class="p">[</span><span class="n">dim</span><span class="p">][</span><span class="n">i</span><span class="p">]])</span>
                        <span class="n">coho_reps_dim</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">triangular</span><span class="p">[</span><span class="n">dim</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">pairs_dim</span><span class="p">):</span>
                <span class="n">pairs_dim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">pairs_dim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">pairs_dim</span><span class="p">)</span>
            <span class="n">lexsrt</span> <span class="o">=</span> <span class="n">_lexsort_barcode</span><span class="p">(</span><span class="n">pairs_dim</span><span class="p">)</span>
            <span class="n">barcode</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pairs_dim</span><span class="p">[</span><span class="n">lexsrt</span><span class="p">])</span>
            <span class="n">coho_reps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nb</span><span class="o">.</span><span class="n">typed</span><span class="o">.</span><span class="n">List</span><span class="p">([</span><span class="n">coho_reps_dim</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">lexsrt</span><span class="p">]))</span>

    <span class="k">return</span> <span class="n">barcode</span><span class="p">,</span> <span class="n">coho_reps</span></div>


<span class="nd">@nb</span><span class="o">.</span><span class="n">njit</span>
<span class="k">def</span> <span class="nf">_initialize_steenrod_matrix</span><span class="p">(</span><span class="n">num_dimensions</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">nb</span><span class="o">.</span><span class="n">typed</span><span class="o">.</span><span class="n">List</span><span class="o">.</span><span class="n">empty_list</span><span class="p">(</span><span class="n">list_of_int64_typ</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_dimensions</span><span class="p">)]</span>


<span class="nd">@lru_cache</span>
<span class="k">def</span> <span class="nf">_populate_steenrod_matrix_single_dim</span><span class="p">(</span><span class="n">dim_plus_k</span><span class="p">):</span>
    <span class="n">length</span> <span class="o">=</span> <span class="n">dim_plus_k</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="nd">@nb</span><span class="o">.</span><span class="n">njit</span><span class="p">(</span><span class="n">parallel</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_inner</span><span class="p">(</span><span class="n">coho_reps_dim</span><span class="p">,</span> <span class="n">tups_dim</span><span class="p">,</span> <span class="n">spx2idx_dim_plus_k</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">steenrod_matrix_dim_plus_k</span> <span class="o">=</span> \
            <span class="n">nb</span><span class="o">.</span><span class="n">typed</span><span class="o">.</span><span class="n">List</span><span class="p">([[</span><span class="n">nb</span><span class="o">.</span><span class="n">int64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">)]</span>
                           <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">coho_reps_dim</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">n_jobs</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">n_jobs</span> <span class="o">=</span> <span class="n">N_PHYSICAL_CORES</span>

        <span class="k">for</span> <span class="n">job_idx</span> <span class="ow">in</span> <span class="n">nb</span><span class="o">.</span><span class="n">prange</span><span class="p">(</span><span class="n">n_jobs</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">coho_reps_dim_idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">job_idx</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">coho_reps_dim</span><span class="p">),</span> <span class="n">n_jobs</span><span class="p">):</span>
                <span class="n">rep</span> <span class="o">=</span> <span class="n">coho_reps_dim</span><span class="p">[</span><span class="n">coho_reps_dim_idx</span><span class="p">]</span>
                <span class="n">cocycle</span> <span class="o">=</span> <span class="n">tups_dim</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">rep</span><span class="p">)]</span>

                <span class="c1"># STSQ</span>
                <span class="n">cochain</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span>
                    <span class="p">[</span><span class="n">to_fixed_tuple</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">length</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">),</span> <span class="n">length</span><span class="p">)</span>
                     <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">)]</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cocycle</span><span class="p">)):</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">cocycle</span><span class="p">)):</span>
                        <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">cocycle</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="nb">set</span><span class="p">(</span><span class="n">cocycle</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                        <span class="n">u</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="o">==</span> <span class="n">length</span><span class="p">:</span>
                            <span class="n">u_tuple</span> <span class="o">=</span> <span class="n">to_fixed_tuple</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">u</span><span class="p">)),</span>
                                                     <span class="n">length</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">u_tuple</span> <span class="ow">in</span> <span class="n">spx2idx_dim_plus_k</span><span class="p">:</span>
                                <span class="n">a_bar</span><span class="p">,</span> <span class="n">b_bar</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">b</span><span class="p">),</span> <span class="n">b</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
                                <span class="n">u_bar</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">a_bar</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">b_bar</span><span class="p">))</span>
                                <span class="n">index</span> <span class="o">=</span> <span class="p">{}</span>
                                <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">a_bar</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">b_bar</span><span class="p">):</span>
                                    <span class="n">pos</span> <span class="o">=</span> <span class="n">u_tuple</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
                                    <span class="n">pos_bar</span> <span class="o">=</span> <span class="n">u_bar</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
                                    <span class="n">index</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">pos</span> <span class="o">+</span> <span class="n">pos_bar</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span>
                                <span class="n">index_a</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
                                <span class="n">index_b</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
                                <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">a_bar</span><span class="p">:</span>
                                    <span class="n">index_a</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">index</span><span class="p">[</span><span class="n">v</span><span class="p">])</span>
                                <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">b_bar</span><span class="p">:</span>
                                    <span class="n">index_b</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">index</span><span class="p">[</span><span class="n">w</span><span class="p">])</span>
                                <span class="k">if</span> <span class="p">(</span><span class="n">index_a</span> <span class="o">==</span> <span class="nb">set</span><span class="p">([</span><span class="mi">0</span><span class="p">])</span>
                                    <span class="ow">and</span> <span class="n">index_b</span> <span class="o">==</span> <span class="nb">set</span><span class="p">([</span><span class="mi">1</span><span class="p">]))</span> \
                                        <span class="ow">or</span> <span class="p">(</span><span class="n">index_a</span> <span class="o">==</span> <span class="nb">set</span><span class="p">([</span><span class="mi">1</span><span class="p">])</span>
                                            <span class="ow">and</span> <span class="n">index_b</span> <span class="o">==</span> <span class="nb">set</span><span class="p">([</span><span class="mi">0</span><span class="p">])):</span>
                                    <span class="n">cochain</span> <span class="o">^=</span> <span class="p">{</span><span class="n">u_tuple</span><span class="p">}</span>

                <span class="n">steenrod_matrix_dim_plus_k</span><span class="p">[</span><span class="n">coho_reps_dim_idx</span><span class="p">]</span> <span class="o">=</span> \
                    <span class="nb">sorted</span><span class="p">([</span><span class="n">spx2idx_dim_plus_k</span><span class="p">[</span><span class="n">spx</span><span class="p">]</span> <span class="k">for</span> <span class="n">spx</span> <span class="ow">in</span> <span class="n">cochain</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">steenrod_matrix_dim_plus_k</span>

    <span class="k">return</span> <span class="n">_inner</span>


<div class="viewcode-block" id="compute_steenrod_matrix"><a class="viewcode-back" href="../../generated/steenroder.compute_steenrod_matrix.html#steenroder.compute_steenrod_matrix">[docs]</a><span class="k">def</span> <span class="nf">compute_steenrod_matrix</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">coho_reps</span><span class="p">,</span> <span class="n">filtration_by_dim</span><span class="p">,</span> <span class="n">spx2idx</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compute the k-th Steenrod matrices in each dimension.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    k : int</span>
<span class="sd">        Positive integer defining the cohomology operation Sq^k to be performed.</span>

<span class="sd">    coho_reps : list of ``numba.typed.List``</span>
<span class="sd">        For each dimension ``d``, a list of representatives of persistent</span>
<span class="sd">        relative cohomology classes in degree ``d``. In the same format as</span>
<span class="sd">        returned by `compute_barcode_and_coho_reps`.</span>

<span class="sd">    filtration_by_dim : list of list of ndarray</span>
<span class="sd">        For each dimension ``d``, a list of 2 aligned int arrays: the first is</span>
<span class="sd">        a 1D array containing the (ordered) positional indices of all</span>
<span class="sd">        ``d``-dimensional simplices in `filtration`; the second is a 2D array</span>
<span class="sd">        whose ``i``-th row is the (sorted) collection of vertices defining the</span>
<span class="sd">        ``i``-th ``d``-dimensional simplex.</span>

<span class="sd">    spx2idx : tuple of ``numba.typed.Dict``</span>
<span class="sd">        One dictionary per simplex dimension. The dimension-``d`` dictionary has</span>
<span class="sd">        the filtration ``d``-simplices (tuples of ints) as keys; the</span>
<span class="sd">        corresponding values are the positional indices of those simplices</span>
<span class="sd">        relative to the ``d``-dimensional portion of the filtration.</span>

<span class="sd">    n_jobs : int, optional, default: ``-1``</span>
<span class="sd">        [Experimental] Controls the number of threads to be used during parallel</span>
<span class="sd">        computation of the Steenrod squares. ``-1`` means using all available</span>
<span class="sd">        physical cores.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    steenrod_matrix : list of ``numba.typed.List``</span>
<span class="sd">        One list per simplex dimension. ``steenrod_matrix[d][j]`` is the result</span>
<span class="sd">        of computing the Steenrod square of ``coho_reps[d - k][j]``.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">steenrod_matrix</span> <span class="o">=</span> <span class="n">_initialize_steenrod_matrix</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">dim</span><span class="p">,</span> <span class="n">coho_reps_dim</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">coho_reps</span><span class="p">[:</span><span class="o">-</span><span class="n">k</span><span class="p">]):</span>
        <span class="n">dim_plus_k</span> <span class="o">=</span> <span class="n">dim</span> <span class="o">+</span> <span class="n">k</span>
        <span class="n">tups_dim</span> <span class="o">=</span> <span class="n">filtration_by_dim</span><span class="p">[</span><span class="n">dim</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">spx2idx_dim_plus_k</span> <span class="o">=</span> <span class="n">spx2idx</span><span class="p">[</span><span class="n">dim</span> <span class="o">+</span> <span class="n">k</span><span class="p">]</span>
        <span class="n">populate_steenrod_matrix_single_dim</span> <span class="o">=</span> \
            <span class="n">_populate_steenrod_matrix_single_dim</span><span class="p">(</span><span class="n">dim_plus_k</span><span class="p">)</span>
        <span class="n">steenrod_matrix_dim_plus_k</span> <span class="o">=</span> <span class="n">populate_steenrod_matrix_single_dim</span><span class="p">(</span>
            <span class="n">coho_reps_dim</span><span class="p">,</span> <span class="n">tups_dim</span><span class="p">,</span> <span class="n">spx2idx_dim_plus_k</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=</span><span class="n">n_jobs</span>
        <span class="p">)</span>
        <span class="n">steenrod_matrix</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">steenrod_matrix_dim_plus_k</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">steenrod_matrix</span></div>


<span class="nd">@nb</span><span class="o">.</span><span class="n">njit</span>
<span class="k">def</span> <span class="nf">_steenrod_barcode_single_dim</span><span class="p">(</span><span class="n">steenrod_matrix_dim</span><span class="p">,</span> <span class="n">n_idxs_dim</span><span class="p">,</span> <span class="n">idxs_prev_dim</span><span class="p">,</span>
                                 <span class="n">reduced_prev_dim</span><span class="p">,</span> <span class="n">births_dim_minus_k</span><span class="p">):</span>
    <span class="c1"># Construct augmented matrix</span>
    <span class="n">augmented</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">reduced_prev_dim</span><span class="p">)):</span>
        <span class="n">augmented</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">nb</span><span class="o">.</span><span class="n">int64</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">reduced_prev_dim</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">steenrod_matrix_dim</span><span class="p">)):</span>
        <span class="n">augmented</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">nb</span><span class="o">.</span><span class="n">int64</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">steenrod_matrix_dim</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>

    <span class="n">n_cols_red</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">reduced_prev_dim</span><span class="p">)</span>
    <span class="n">n_cols_st</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">steenrod_matrix_dim</span><span class="p">)</span>
    <span class="n">n_births_dim_minus_k</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">births_dim_minus_k</span><span class="p">)</span>

    <span class="n">pivots_lookup</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">n_idxs_dim</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
    <span class="n">alive</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">n_births_dim_minus_k</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">bool_</span><span class="p">)</span>
    <span class="n">steenrod_barcode_dim</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">n_cols_st_curr</span><span class="p">,</span> <span class="n">birth</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">births_dim_minus_k</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">idxs_prev_dim</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">birth</span><span class="p">:</span>
            <span class="k">break</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n_cols_red</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">idxs_prev_dim</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">next_birth</span> <span class="o">=</span> <span class="n">births_dim_minus_k</span><span class="p">[</span><span class="n">n_cols_st_curr</span><span class="p">]</span>
        <span class="n">is_idx_geq</span> <span class="o">=</span> <span class="n">idx</span> <span class="o">&gt;=</span> <span class="n">next_birth</span>
        <span class="k">if</span> <span class="n">is_idx_geq</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">i</span><span class="p">:</span>
                <span class="n">next_idx</span> <span class="o">=</span> <span class="n">idxs_prev_dim</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_cols_st_curr</span><span class="p">,</span> <span class="n">n_cols_st</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">next_idx</span> <span class="o">&gt;=</span> <span class="n">births_dim_minus_k</span><span class="p">[</span><span class="n">jj</span><span class="p">]:</span>
                        <span class="k">break</span>
                    <span class="n">n_cols_st_curr</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">n_cols_st_curr</span> <span class="o">=</span> <span class="n">n_cols_st</span>

        <span class="k">if</span> <span class="n">augmented</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
            <span class="n">pivots_lookup</span><span class="p">[</span><span class="n">augmented</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">i</span>

        <span class="n">pivot_col_idxs_from_st</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_cols_red</span><span class="p">,</span> <span class="n">n_cols_red</span> <span class="o">+</span> <span class="n">n_cols_st_curr</span><span class="p">):</span>
            <span class="n">highest_one</span> <span class="o">=</span> <span class="n">augmented</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">augmented</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span>
            <span class="n">pivot_col</span> <span class="o">=</span> <span class="n">pivots_lookup</span><span class="p">[</span><span class="n">highest_one</span><span class="p">]</span>
            <span class="k">while</span> <span class="p">(</span><span class="n">highest_one</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">pivot_col</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">augmented</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="n">_symm_diff</span><span class="p">(</span><span class="n">augmented</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">1</span><span class="p">:],</span>
                                           <span class="n">augmented</span><span class="p">[</span><span class="n">pivot_col</span><span class="p">][</span><span class="mi">1</span><span class="p">:])</span>
                <span class="n">highest_one</span> <span class="o">=</span> <span class="n">augmented</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">augmented</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span>
                <span class="n">pivot_col</span> <span class="o">=</span> <span class="n">pivots_lookup</span><span class="p">[</span><span class="n">highest_one</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">highest_one</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">pivots_lookup</span><span class="p">[</span><span class="n">highest_one</span><span class="p">]</span> <span class="o">=</span> <span class="n">ii</span>
                <span class="c1"># Record pivot indices coming from Steenrod part of augmented</span>
                <span class="n">pivot_col_idxs_from_st</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">highest_one</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">alive</span><span class="p">[</span><span class="n">ii</span> <span class="o">-</span> <span class="n">n_cols_red</span><span class="p">]:</span>
                <span class="n">alive</span><span class="p">[</span><span class="n">ii</span> <span class="o">-</span> <span class="n">n_cols_red</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">birth</span> <span class="o">=</span> <span class="n">births_dim_minus_k</span><span class="p">[</span><span class="n">ii</span> <span class="o">-</span> <span class="n">n_cols_red</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">idx</span> <span class="o">&lt;</span> <span class="n">birth</span><span class="p">:</span>
                    <span class="n">steenrod_barcode_dim</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">idx</span><span class="p">,</span> <span class="n">birth</span><span class="p">])</span>

        <span class="c1"># Reset pivots_lookup for next iteration</span>
        <span class="k">for</span> <span class="n">col_idx</span> <span class="ow">in</span> <span class="n">pivot_col_idxs_from_st</span><span class="p">:</span>
            <span class="n">pivots_lookup</span><span class="p">[</span><span class="n">col_idx</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_births_dim_minus_k</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">alive</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
            <span class="n">steenrod_barcode_dim</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">births_dim_minus_k</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>

    <span class="k">return</span> <span class="n">steenrod_barcode_dim</span>


<div class="viewcode-block" id="compute_steenrod_barcode"><a class="viewcode-back" href="../../generated/steenroder.compute_steenrod_barcode.html#steenroder.compute_steenrod_barcode">[docs]</a><span class="k">def</span> <span class="nf">compute_steenrod_barcode</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">steenrod_matrix</span><span class="p">,</span> <span class="n">idxs</span><span class="p">,</span> <span class="n">reduced</span><span class="p">,</span> <span class="n">barcode</span><span class="p">,</span>
                         <span class="n">filtration_values</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compute the Sq^k-barcode of relative cohomology.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    k : int</span>
<span class="sd">        Positive integer defining the cohomology operation Sq^k to be performed.</span>

<span class="sd">    steenrod_matrix : list of ``numba.typed.List``</span>
<span class="sd">        One list per simplex dimension. ``steenrod_matrix[d][j]`` is the result</span>
<span class="sd">        of computing the Steenrod square of the ``j``th latest (by birth)</span>
<span class="sd">        persistent relative cohomology representative in degree ``d`` (and this</span>
<span class="sd">        representative must represent bar ``barcode[d][j]``). See</span>
<span class="sd">        `compute_steenrod_matrix`.</span>

<span class="sd">    idxs : tuple of ndarray</span>
<span class="sd">        For each dimension ``d``, a 1D int array containing the (ordered)</span>
<span class="sd">        positional indices of all ``d``-dimensional simplices in the filtration.</span>

<span class="sd">    reduced : tuple of ``numba.typed.List``</span>
<span class="sd">        One list of int per simplex dimension, representing the</span>
<span class="sd">        ``d``-dimensional part of the &quot;R&quot; matrix in R = DV. In the same format</span>
<span class="sd">        as returned by `compute_reduced_triangular`.</span>

<span class="sd">    barcode : list of ndarray</span>
<span class="sd">        For each dimension ``d``, a 2D int array of shape ``(n_bars, 2)``</span>
<span class="sd">        containing the birth (entry 1) and death (entry 0) indices of persistent</span>
<span class="sd">        relative homology classes in degree ``d``. Essential bars must be</span>
<span class="sd">        represented by pairs with death equal to ``-1``. Bars must be sorted in</span>
<span class="sd">        order of decreasing birth indices.</span>

<span class="sd">    filtration_values : ndarray or None, optional, default: None</span>
<span class="sd">        Optionally, a single 1D array of filtration values for each simplex in</span>
<span class="sd">        the filtration and in all dimensions contained in `idxs` and `reduced`.</span>
<span class="sd">        Steenrod bars with equal birth and death filtration values are</span>
<span class="sd">        discarded.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    steenrod_barcode : list of ndarray</span>
<span class="sd">        The (relative) Sq^k-barcode. For each dimension ``d``, a 2D int array</span>
<span class="sd">        of shape ``(n_bars, 2)`` containing the birth (entry 1) and death (entry</span>
<span class="sd">        0) indices of Steenrod bars. Essential Steenrod bars are represented by</span>
<span class="sd">        pairs with death equal to ``-1``.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">nontrivial_bars</span><span class="p">(</span><span class="n">barcode_dim</span><span class="p">):</span>
        <span class="n">infinite_bars</span> <span class="o">=</span> <span class="n">barcode_dim</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span>
            <span class="n">infinite_bars</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_not</span><span class="p">(</span><span class="n">infinite_bars</span><span class="p">),</span>
                           <span class="p">(</span><span class="n">filtration_values</span><span class="p">[</span><span class="n">barcode_dim</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]]</span> <span class="o">!=</span>
                            <span class="n">filtration_values</span><span class="p">[</span><span class="n">barcode_dim</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]]))</span>
        <span class="p">)</span>

    <span class="n">steenrod_barcode</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">k</span><span class="p">)]</span>
    <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">steenrod_matrix</span><span class="p">)):</span>
        <span class="n">births_dim_minus_k</span> <span class="o">=</span> <span class="n">barcode</span><span class="p">[</span><span class="n">dim</span> <span class="o">-</span> <span class="n">k</span><span class="p">][:,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">idxs_dim</span> <span class="o">=</span> <span class="n">idxs</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span>
        <span class="n">idxs_prev_dim</span> <span class="o">=</span> <span class="n">idxs</span><span class="p">[</span><span class="n">dim</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">reduced_prev_dim</span> <span class="o">=</span> <span class="n">reduced</span><span class="p">[</span><span class="n">dim</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">steenrod_barcode_dim</span> <span class="o">=</span> <span class="n">_steenrod_barcode_single_dim</span><span class="p">(</span><span class="n">steenrod_matrix</span><span class="p">[</span><span class="n">dim</span><span class="p">],</span>
                                                      <span class="nb">len</span><span class="p">(</span><span class="n">idxs_dim</span><span class="p">),</span>
                                                      <span class="n">idxs_prev_dim</span><span class="p">,</span>
                                                      <span class="n">reduced_prev_dim</span><span class="p">,</span>
                                                      <span class="n">births_dim_minus_k</span><span class="p">)</span>
        <span class="c1"># NB: Conversion to array must happen outside jitted code due to</span>
        <span class="c1"># https://github.com/numba/numba/issues/3579</span>
        <span class="n">steenrod_barcode_dim</span> <span class="o">=</span> \
            <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">steenrod_barcode_dim</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">filtration_values</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">nontrivial_mask</span> <span class="o">=</span> <span class="n">nontrivial_bars</span><span class="p">(</span><span class="n">steenrod_barcode_dim</span><span class="p">)</span>
            <span class="n">steenrod_barcode_dim</span> <span class="o">=</span> <span class="n">steenrod_barcode_dim</span><span class="p">[</span><span class="n">nontrivial_mask</span><span class="p">]</span>
        <span class="n">steenrod_barcode</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">steenrod_barcode_dim</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">steenrod_barcode</span></div>


<div class="viewcode-block" id="barcodes"><a class="viewcode-back" href="../../generated/steenroder.barcodes.html#steenroder.barcodes">[docs]</a><span class="k">def</span> <span class="nf">barcodes</span><span class="p">(</span>
        <span class="n">k</span><span class="p">,</span> <span class="n">filtration</span><span class="p">,</span> <span class="n">absolute</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">filtration_values</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">return_filtration_values</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">maxdim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Given a filtration, compute ordinary persistent (relative or absolute)</span>
<span class="sd">    cohomology barcodes and relative Steenrod barcodes.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    k : int</span>
<span class="sd">        Positive integer defining the cohomology operation Sq^k to be performed.</span>

<span class="sd">    filtration : sequence of list-like of int</span>
<span class="sd">        Represents a simplex-wise filtration. Entry ``i`` is a list/tuple/set</span>
<span class="sd">        containing the integer indices of the vertices defining the ``i``-th</span>
<span class="sd">        simplex in the filtration.</span>

<span class="sd">    absolute : bool, optional, default: ``False``</span>
<span class="sd">        If ``True``, return the ordinary persistent absolute homology barcode,</span>
<span class="sd">        and move inessential relative Steenrod bars to one degree lower while</span>
<span class="sd">        keeping essential bars in their degree. If ``False``, return the</span>
<span class="sd">        ordinary persistent relative cohomology barcode and relative Steenrod</span>
<span class="sd">        barcode.</span>

<span class="sd">    filtration_values : ndarray or None, optional, default: None</span>
<span class="sd">        Optionally, a single 1D array of filtration values for each simplex in</span>
<span class="sd">        the filtration. Ordinary and Steenrod bars with equal birth and death</span>
<span class="sd">        filtration values are discarded by the computation.</span>

<span class="sd">    return_filtration_values : bool, optional, default: ``False``</span>
<span class="sd">        If ``True``, birth and deaths will be expressed as filtration values</span>
<span class="sd">        instead of filtration indices. Ignored if `filtration_values` is</span>
<span class="sd">        ``None``.</span>

<span class="sd">    maxdim : int or None, optional, default: None</span>
<span class="sd">        Maximum simplex dimension to be included. ``None`` means that all</span>
<span class="sd">        simplices are included.</span>

<span class="sd">    n_jobs : int, optional, default: ``1``</span>
<span class="sd">        [Experimental] Controls the number of threads to be used during parallel</span>
<span class="sd">        computation of the Steenrod squares. ``-1`` means using all available</span>
<span class="sd">        physical cores.</span>

<span class="sd">    verbose : bool, optional, default: ``False``</span>
<span class="sd">        Whether to print timings for the intermediate steps in the computation.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    barcode : list of ndarray</span>
<span class="sd">        For each dimension ``d``, a 2D int or float array of shape ``(n_bars,</span>
<span class="sd">        2)`` containing the births and deaths of persistent relative cohomology</span>
<span class="sd">        classes in degree ``d``. If `absolute` is ``False``, the birth of a bar</span>
<span class="sd">        is in entry 1 and the death in entry 0; otherwise, the positions are</span>
<span class="sd">        reversed. Births and death are expressed either as global filtration</span>
<span class="sd">        indices or as filtration values depending on `filtration_values` and</span>
<span class="sd">        `return_filtration_values`. If they are expressed as indices, essential</span>
<span class="sd">        bars have death equal to ``-1``; otherwise, essential bars have death</span>
<span class="sd">        equal to ``numpy.inf``.</span>

<span class="sd">    steenrod_barcode : list of ndarray</span>
<span class="sd">        The (relative) Sq^k-barcode. For each dimension ``d``, a 2D int or float</span>
<span class="sd">        array of shape ``(n_bars, 2)`` containing the birth (entry 1) and death</span>
<span class="sd">        (entry 0) indices of Steenrod bars. The same conventions as for</span>
<span class="sd">        `barcode` are used for birth and death values.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="n">tic</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">filtration_by_dim</span> <span class="o">=</span> <span class="n">sort_filtration_by_dim</span><span class="p">(</span><span class="n">filtration</span><span class="p">,</span> <span class="n">maxdim</span><span class="o">=</span><span class="n">maxdim</span><span class="p">)</span>
    <span class="n">spx2idx</span><span class="p">,</span> <span class="n">idxs</span><span class="p">,</span> <span class="n">reduced</span><span class="p">,</span> <span class="n">triangular</span> <span class="o">=</span> \
        <span class="n">compute_reduced_triangular</span><span class="p">(</span><span class="n">filtration_by_dim</span><span class="p">)</span>
    <span class="n">barcode</span><span class="p">,</span> <span class="n">coho_reps</span> <span class="o">=</span> \
        <span class="n">compute_barcode_and_coho_reps</span><span class="p">(</span><span class="n">idxs</span><span class="p">,</span> <span class="n">reduced</span><span class="p">,</span> <span class="n">triangular</span><span class="p">,</span>
                                  <span class="n">filtration_values</span><span class="o">=</span><span class="n">filtration_values</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># Sq^0 is the identity</span>
        <span class="k">return</span> <span class="n">barcode</span><span class="p">,</span> <span class="n">barcode</span>

    <span class="k">if</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># Sq^k is the zero map</span>
        <span class="k">return</span> <span class="n">barcode</span><span class="p">,</span> <span class="nb">list</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="n">toc</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Usual barcode computed, time taken: </span><span class="si">{</span><span class="p">(</span><span class="n">toc</span> <span class="o">-</span> <span class="n">tic</span><span class="p">)</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> s&quot;</span><span class="p">)</span>
        <span class="n">tic</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">steenrod_matrix</span> <span class="o">=</span> <span class="n">compute_steenrod_matrix</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">coho_reps</span><span class="p">,</span> <span class="n">filtration_by_dim</span><span class="p">,</span>
                                          <span class="n">spx2idx</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=</span><span class="n">n_jobs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="n">toc</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Steenrod matrix computed, time taken: </span><span class="si">{</span><span class="p">(</span><span class="n">toc</span> <span class="o">-</span> <span class="n">tic</span><span class="p">)</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> s&quot;</span><span class="p">)</span>
        <span class="n">tic</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">steenrod_barcode</span> <span class="o">=</span> <span class="n">compute_steenrod_barcode</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">steenrod_matrix</span><span class="p">,</span> <span class="n">idxs</span><span class="p">,</span> <span class="n">reduced</span><span class="p">,</span>
                                      <span class="n">barcode</span><span class="p">,</span>
                                      <span class="n">filtration_values</span><span class="o">=</span><span class="n">filtration_values</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="n">toc</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Steenrod barcode computed, time taken: </span><span class="si">{</span><span class="p">(</span><span class="n">toc</span> <span class="o">-</span> <span class="n">tic</span><span class="p">)</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> s&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">absolute</span><span class="p">:</span>
        <span class="n">barcode</span> <span class="o">=</span> <span class="n">_to_absolute_barcode</span><span class="p">(</span>
            <span class="n">barcode</span><span class="p">,</span> <span class="n">filtration_values</span><span class="o">=</span><span class="n">filtration_values</span><span class="p">,</span>
            <span class="n">return_filtration_values</span><span class="o">=</span><span class="n">return_filtration_values</span>
        <span class="p">)</span>
        <span class="n">steenrod_barcode</span> <span class="o">=</span> <span class="n">_to_absolute_barcode</span><span class="p">(</span>
            <span class="n">steenrod_barcode</span><span class="p">,</span> <span class="n">filtration_values</span><span class="o">=</span><span class="n">filtration_values</span><span class="p">,</span>
            <span class="n">return_filtration_values</span><span class="o">=</span><span class="n">return_filtration_values</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">barcode</span><span class="p">,</span> <span class="n">steenrod_barcode</span>

    <span class="k">elif</span> <span class="n">return_filtration_values</span> <span class="ow">and</span> <span class="p">(</span><span class="n">filtration_values</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">barcode</span> <span class="o">=</span> <span class="n">_to_values_barcode</span><span class="p">(</span><span class="n">barcode</span><span class="p">,</span> <span class="n">filtration_values</span><span class="p">)</span>
        <span class="n">steenrod_barcode</span> <span class="o">=</span> <span class="n">_to_values_barcode</span><span class="p">(</span><span class="n">steenrod_barcode</span><span class="p">,</span> <span class="n">filtration_values</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">barcode</span><span class="p">,</span> <span class="n">steenrod_barcode</span></div>


<span class="k">def</span> <span class="nf">_to_absolute_barcode</span><span class="p">(</span><span class="n">rel_barcode</span><span class="p">,</span> <span class="n">filtration_values</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                         <span class="n">return_filtration_values</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="n">abs_barcode</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">return_filtration_values</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">filtration_values</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int64</span>
        <span class="k">for</span> <span class="n">dim</span><span class="p">,</span> <span class="n">rel_barcode_dim</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">rel_barcode</span><span class="p">):</span>
            <span class="n">abs_barcode_dim</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">pair</span> <span class="ow">in</span> <span class="n">rel_barcode_dim</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">pair</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">abs_barcode_dim</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">pair</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">abs_barcode</span><span class="p">[</span><span class="n">dim</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">pair</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pair</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">abs_barcode</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">abs_barcode_dim</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">dtype</span> <span class="o">=</span> <span class="n">filtration_values</span><span class="o">.</span><span class="n">dtype</span>
        <span class="k">for</span> <span class="n">dim</span><span class="p">,</span> <span class="n">rel_barcode_dim</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">rel_barcode</span><span class="p">):</span>
            <span class="n">abs_barcode_dim</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">pair</span> <span class="ow">in</span> <span class="n">rel_barcode_dim</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">pair</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">abs_barcode_dim</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="p">(</span><span class="n">filtration_values</span><span class="p">[</span><span class="n">pair</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">abs_barcode</span><span class="p">[</span><span class="n">dim</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="p">(</span><span class="n">filtration_values</span><span class="p">[</span><span class="n">pair</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">filtration_values</span><span class="p">[</span><span class="n">pair</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
                    <span class="p">)</span>
            <span class="n">abs_barcode</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">abs_barcode_dim</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">abs_barcode_dim</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">abs_barcode_dim</span> <span class="ow">in</span> <span class="n">abs_barcode</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">_to_values_barcode</span><span class="p">(</span><span class="n">barcode</span><span class="p">,</span> <span class="n">filtration_values</span><span class="p">):</span>
    <span class="n">values_barcode</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">dim</span><span class="p">,</span> <span class="n">barcode_dim</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">barcode</span><span class="p">):</span>
        <span class="n">values_barcode_dim</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">pair</span> <span class="ow">in</span> <span class="n">barcode_dim</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">pair</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">values_barcode_dim</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">filtration_values</span><span class="p">[</span><span class="n">pair</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">values_barcode_dim</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="p">(</span><span class="n">filtration_values</span><span class="p">[</span><span class="n">pair</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">filtration_values</span><span class="p">[</span><span class="n">pair</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
                <span class="p">)</span>
        <span class="n">values_barcode</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">values_barcode_dim</span><span class="p">,</span>
                     <span class="n">dtype</span><span class="o">=</span><span class="n">filtration_values</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">values_barcode</span>


<span class="nd">@nb</span><span class="o">.</span><span class="n">njit</span>
<span class="k">def</span> <span class="nf">_symm_diff</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">m</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">j</span> <span class="o">&lt;</span> <span class="n">m</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">y</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">y</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
            <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">:</span>
        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">while</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">m</span><span class="p">:</span>
        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
        <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="n">result</span>


<span class="nd">@nb</span><span class="o">.</span><span class="n">njit</span>
<span class="k">def</span> <span class="nf">_lexsort_barcode</span><span class="p">(</span><span class="n">arr</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">arr</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>


<span class="nd">@nb</span><span class="o">.</span><span class="n">njit</span>
<span class="k">def</span> <span class="nf">_drop_elements</span><span class="p">(</span><span class="n">tup</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tup</span><span class="p">)):</span>
        <span class="n">empty</span> <span class="o">=</span> <span class="n">tup</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># Not empty, but the right size and will be mutated</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tup</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">x</span><span class="p">:</span>
                <span class="n">empty</span> <span class="o">=</span> <span class="n">tuple_setitem</span><span class="p">(</span><span class="n">empty</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">tup</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="n">idx</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">yield</span> <span class="n">empty</span>


<div class="viewcode-block" id="rips_barcodes"><a class="viewcode-back" href="../../generated/steenroder.rips_barcodes.html#steenroder.rips_barcodes">[docs]</a><span class="k">def</span> <span class="nf">rips_barcodes</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">max_edge_length</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">distance_matrix</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                  <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_simplex_dimension</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">absolute</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                  <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Construct a Rips filtration and compute ordinary persistent (relative or</span>
<span class="sd">    absolute) cohomology barcodes and relative Steenrod barcodes.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    X : ndarray of shape (n_samples, n_features) or (n_samples, n_samples)</span>
<span class="sd">        Input point cloud (if `distance_matrix` is ``False``) or distance matrix</span>
<span class="sd">        (if `distance_matrix` is ``True``).</span>

<span class="sd">    max_edge_length : float, optional, default: ``np.inf``</span>
<span class="sd">        VietorisRips filtration threshold.</span>

<span class="sd">    distance_matrix : bool, optional, default: ``False``</span>
<span class="sd">        Whether the input `X` is a distance matrix or a point cloud.</span>

<span class="sd">    k : int</span>
<span class="sd">        Positive integer defining the cohomology operation Sq^k to be performed.</span>

<span class="sd">    max_simplex_dimension : int, optional, default: ``2``</span>
<span class="sd">        Maximum simplex dimension to be included in the Rips filtration.</span>

<span class="sd">    absolute : bool, optional, default: ``False``</span>
<span class="sd">        If ``True``, return the ordinary persistent absolute homology barcode,</span>
<span class="sd">        and move inessential relative Steenrod bars to one degree lower while</span>
<span class="sd">        keeping essential bars in their degree. If ``False``, return the</span>
<span class="sd">        ordinary persistent relative cohomology barcode and relative Steenrod</span>
<span class="sd">        barcode.</span>

<span class="sd">    n_jobs : int, optional, default: ``1``</span>
<span class="sd">        [Experimental] Controls the number of threads to be used during parallel</span>
<span class="sd">        computation of the Steenrod squares. ``-1`` means using all available</span>
<span class="sd">        physical cores.</span>

<span class="sd">    verbose : bool, optional, default: ``False``</span>
<span class="sd">        Whether to print information about the intermediate steps in the</span>
<span class="sd">        computation.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    barcode : list of ndarray</span>
<span class="sd">        For each dimension ``d``, a 2D int or float array of shape ``(n_bars,</span>
<span class="sd">        2)`` containing the births and deaths of persistent relative cohomology</span>
<span class="sd">        classes in degree ``d``. If `absolute` is ``False``, the birth of a bar</span>
<span class="sd">        is in entry 1 and the death in entry 0; otherwise, the positions are</span>
<span class="sd">        reversed. Births and death are expressed either as global filtration</span>
<span class="sd">        indices or as filtration values depending on `filtration_values` and</span>
<span class="sd">        `return_filtration_values`. If they are expressed as indices, essential</span>
<span class="sd">        bars have death equal to ``-1``; otherwise, essential bars have death</span>
<span class="sd">        equal to ``numpy.inf``.</span>

<span class="sd">    steenrod_barcode : list of ndarray</span>
<span class="sd">        The (relative) Sq^k-barcode. For each dimension ``d``, a 2D int or float</span>
<span class="sd">        array of shape ``(n_bars, 2)`` containing the birth (entry 1) and death</span>
<span class="sd">        (entry 0) indices of Steenrod bars. The same conventions as for</span>
<span class="sd">        `barcode` are used for birth and death values.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">spx_tree_kwargs</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;distance_matrix&quot;</span> <span class="k">if</span> <span class="n">distance_matrix</span> <span class="k">else</span> <span class="s2">&quot;points&quot;</span><span class="p">:</span> <span class="n">X</span><span class="p">,</span>
        <span class="s2">&quot;max_edge_length&quot;</span><span class="p">:</span> <span class="n">max_edge_length</span>
    <span class="p">}</span>
    <span class="n">spx_tree</span> <span class="o">=</span> <span class="n">gudhi</span><span class="o">.</span><span class="n">RipsComplex</span><span class="p">(</span><span class="o">**</span><span class="n">spx_tree_kwargs</span><span class="p">)</span><span class="o">.</span>\
        <span class="n">create_simplex_tree</span><span class="p">(</span><span class="n">max_dimension</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">len_filtration</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">spx_tree</span><span class="o">.</span><span class="n">get_filtration</span><span class="p">()):</span>
            <span class="k">pass</span>
        <span class="n">len_filtration</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Filtration with </span><span class="si">{</span><span class="n">len_filtration</span><span class="si">}</span><span class="s2"> simplices up to dimension 1 &quot;</span>
              <span class="s2">&quot;initially&quot;</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Running Edge Collapse...&quot;</span><span class="p">)</span>

    <span class="n">it</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">spx_tree</span><span class="o">.</span><span class="n">collapse_edges</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">spx_tree</span><span class="o">.</span><span class="n">get_filtration</span><span class="p">()):</span>
            <span class="k">pass</span>

        <span class="k">if</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">==</span> <span class="n">len_filtration</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">len_filtration</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">it</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  EC iteration </span><span class="si">{</span><span class="n">it</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">len_filtration</span><span class="si">}</span><span class="s2"> simplices up to &quot;</span>
                      <span class="s2">&quot;dimension 1&quot;</span><span class="p">)</span>

    <span class="c1"># Construct the Rips filtration and run Steenroder</span>
    <span class="n">spx_tree</span><span class="o">.</span><span class="n">expansion</span><span class="p">(</span><span class="n">max_simplex_dimension</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">spx_tree</span><span class="o">.</span><span class="n">get_filtration</span><span class="p">()):</span>
            <span class="k">pass</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;There are </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> simplices up to dimension &quot;</span>
              <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">max_simplex_dimension</span><span class="si">}</span><span class="s2"> after EC.&quot;</span><span class="p">)</span>

    <span class="n">filtration</span><span class="p">,</span> <span class="n">filtration_values</span> <span class="o">=</span> \
        <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="p">((</span><span class="nb">tuple</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">spx_tree</span><span class="o">.</span><span class="n">get_filtration</span><span class="p">()))</span>
    <span class="n">filtration_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">filtration_values</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

    <span class="n">barcode</span><span class="p">,</span> <span class="n">steenrod_barcode</span> <span class="o">=</span> <span class="n">barcodes</span><span class="p">(</span>
        <span class="n">k</span><span class="p">,</span>
        <span class="n">filtration</span><span class="p">,</span>
        <span class="n">filtration_values</span><span class="o">=</span><span class="n">filtration_values</span><span class="p">,</span>
        <span class="n">absolute</span><span class="o">=</span><span class="n">absolute</span><span class="p">,</span>
        <span class="n">return_filtration_values</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">n_jobs</span><span class="o">=</span><span class="n">n_jobs</span><span class="p">,</span>
        <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">barcode</span><span class="p">,</span> <span class="n">steenrod_barcode</span></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Steenroder.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>